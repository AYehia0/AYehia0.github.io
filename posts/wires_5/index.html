

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>Wires #5: Exploring the .NET Web API and enable HTTPs [Backend] - ::1 404</title><meta name="Description" content=""><meta property="og:title" content="Wires #5: Exploring the .NET Web API and enable HTTPs [Backend]" />
<meta property="og:description" content="Let&rsquo;s explore dotnet everyone :D" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ayehia0.github.io/posts/wires_5/" /><meta property="og:image" content="https://ayehia0.github.io/posts/wires_5/featured-image.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T01:08:16+02:00" />
<meta property="article:modified_time" content="2024-09-13T22:43:40+00:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ayehia0.github.io/posts/wires_5/featured-image.png"/>
<meta name="twitter:title" content="Wires #5: Exploring the .NET Web API and enable HTTPs [Backend]"/>
<meta name="twitter:description" content="Let&rsquo;s explore dotnet everyone :D"/>
<meta name="application-name" content="::1 404">
<meta name="apple-mobile-web-app-title" content="::1 404">

<meta name="theme-color" content="#f8f8f8"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="canonical" href="https://ayehia0.github.io/posts/wires_5/" /><link rel="prev" href="https://ayehia0.github.io/posts/wires_4/" /><link rel="next" href="https://ayehia0.github.io/posts/wires_6/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Wires #5: Exploring the .NET Web API and enable HTTPs [Backend]",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/ayehia0.github.io\/posts\/wires_5\/"
        },"image": ["https:\/\/ayehia0.github.io\/images\/me.jpg"],"genre": "posts","wordcount":  480 ,
        "url": "https:\/\/ayehia0.github.io\/posts\/wires_5\/","datePublished": "2024-01-03T01:08:16+02:00","dateModified": "2024-09-13T22:43:40+00:00","publisher": {
            "@type": "Organization",
            "name": "Yehia"},"author": {
                "@type": "Person",
                "name": "Yehia"
            },"description": ""
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="::1 404"><span class="header-title-pre"><i class="fas fa-splotch"></i></span><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="::1 404"><span class="header-title-pre"><i class="fas fa-splotch"></i></span><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content always-active" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#how-to-use-environment-variables">How to use Environment Variables</a></li>
    <li><a href="#how-enable-ssl-on-the-application">How enable SSL on the application</a></li>
    <li><a href="#working-with-the-dotnet-cli">Working with the dotnet CLI</a></li>
    <li><a href="#testing-the-api">Testing the API</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Wires #5: Exploring the .NET Web API and enable HTTPs [Backend]</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="https://github.com/AYehia0" title="Author" target="_blank" rel="noopener noreferrer author" class="author">Yehia</a>
                </span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2024-01-03">2024-01-03</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2024-09-13">2024-09-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;480 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;3 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        
        loading="eager"
        src="/posts/wires_5/featured-image.png"
        srcset="/posts/wires_5/featured-image.png, /posts/wires_5/featured-image.png 1.5x, /posts/wires_5/featured-image.png 2x"
        sizes="auto"
        alt="/posts/wires_5/featured-image.png"
        title="/posts/wires_5/featured-image.png" height="900"   width="1720" ></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#how-to-use-environment-variables">How to use Environment Variables</a></li>
    <li><a href="#how-enable-ssl-on-the-application">How enable SSL on the application</a></li>
    <li><a href="#working-with-the-dotnet-cli">Working with the dotnet CLI</a></li>
    <li><a href="#testing-the-api">Testing the API</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Let&rsquo;s explore dotnet everyone :D</p>
<h2 id="how-to-use-environment-variables" class="headerLink">
    <a href="#how-to-use-environment-variables" class="header-mark"></a>How to use Environment Variables</h2><p>How to use the Environment Variables to allow separate production from development</p>
<h2 id="how-enable-ssl-on-the-application" class="headerLink">
    <a href="#how-enable-ssl-on-the-application" class="header-mark"></a>How enable SSL on the application</h2><p>As you know I issued a SSL Certificate using the certbot which uses <code>let's encrypt</code>, it took me so much time to figure this out as the docs aren&rsquo;t clear at all.</p>
<figure><a class="lightgallery" href="/posts/wires_5/ssl_errors.png" title="/posts/wires_5/ssl_errors.png" data-thumbnail="/posts/wires_5/ssl_errors.png" data-sub-html="<h2>I wasted 2 days trying to fix that, and I even gave up and switched to Go!</h2>">
        <img
            
            loading="lazy"
            src="/posts/wires_5/ssl_errors.png"
            srcset="/posts/wires_5/ssl_errors.png, /posts/wires_5/ssl_errors.png 1.5x, /posts/wires_5/ssl_errors.png 2x"
            sizes="auto"
            alt="/posts/wires_5/ssl_errors.png" height="756"  width="1889" >
    </a><figcaption class="image-caption">I wasted 2 days trying to fix that, and I even gave up and switched to Go!</figcaption>
    </figure>
<p>Certbot generates some <code>.pem</code> files, which is used by almost all the apis expect .NET or Idk how to use them with <code>Kestrel</code>. Anyway certs and keys need to be converted from <code>.pem</code> file to <code>.pfx</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo openssl pkcs12 -export -out cert.pfx \
</span></span><span class="line"><span class="cl">    -inkey /etc/letsencrypt/live/&lt;domain&gt;/privkey.pem \
</span></span><span class="line"><span class="cl">    -in /etc/letsencrypt/live/&lt;domain&gt;/fullchain.pem
</span></span></code></pre></td></tr></table>
</div>
</div><p>It will ask for a password which is used later to configure <code>Kestrel</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="c1">// enable https</span>
</span></span><span class="line"><span class="cl"><span class="n">builder</span><span class="p">.</span><span class="n">WebHost</span><span class="p">.</span><span class="n">UseKestrel</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">options</span><span class="p">.</span><span class="n">ListenAnyIP</span><span class="p">(</span><span class="m">443</span><span class="p">,</span> <span class="n">listenOptions</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">listenOptions</span><span class="p">.</span><span class="n">UseHttps</span><span class="p">(</span><span class="s">&#34;cert.pfx&#34;</span><span class="p">,</span> <span class="s">&#34;password&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>PS: I hate how C# loves to waste a new line for <code>{}</code></p>
<h2 id="working-with-the-dotnet-cli" class="headerLink">
    <a href="#working-with-the-dotnet-cli" class="header-mark"></a>Working with the dotnet CLI</h2><p>Navigate to the <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/" target="_blank" rel="noopener noreferrer">docs</a> to learn more about the dotnet CLI.</p>
<ul>
<li>How to create a template webapi with controllers : <code>dotnet new webapi --use-controllers -n backend</code></li>
<li>Build vs Publish</li>
</ul>
<p><code>Building</code> is the process of compiling the source code of your application into executable files or libraries. When you build a .NET application, the compiler translates your source code (written in C#, F#, or another supported language) into Intermediate Language (IL) code, which is then packaged into assemblies.</p>
<p>The build process involves several steps:</p>
<ol>
<li>Compilation: The compiler translates the source code into IL code.</li>
<li>Assembly Generation: The IL code is packaged into assemblies, which may include executable files (e.g., .exe for console applications) and/or dynamic link libraries (DLLs).</li>
<li>Dependency Resolution: Dependencies are resolved, and required libraries are referenced.</li>
<li>Output Generation: The compiled application or library is generated as output.</li>
</ol>
<p><code>Publishing</code> is the process of preparing and packaging your application for deployment. It involves not only building the application but also including all necessary files and dependencies to ensure that the application can run on the target environment.</p>
<p>The publish process includes the following steps:</p>
<ol>
<li>Build: The application is built, following the same steps as in the build process.</li>
<li>Dependency Packaging: All required dependencies (including .NET runtime components) are packaged with the application.</li>
<li>Configuration Transformation: Configuration files may be transformed based on the target environment.</li>
<li>Output Packaging: The application is packaged into a directory or a single executable file.</li>
</ol>
<h2 id="testing-the-api" class="headerLink">
    <a href="#testing-the-api" class="header-mark"></a>Testing the API</h2><p>Before this step, I created a domain called <code>api</code> which I will link the application to server on it using HTTPs (Make sure to also create a cert if you haven&rsquo;t).</p>
<p>Let&rsquo;s publish and run the server!</p>
<ol>
<li>Publish: <code>dotnet publish</code></li>
<li>Run: Make run that the server is running with <code>sudo</code> as for ports lower than <code>1024</code> : <code>sudo dotnet backend.dll</code></li>
</ol>
<figure><a class="lightgallery" href="/posts/wires_5/https.png" title="/posts/wires_5/https.png" data-thumbnail="/posts/wires_5/https.png" data-sub-html="<h2>Now API works with HTTPs</h2>">
        <img
            
            loading="lazy"
            src="/posts/wires_5/https.png"
            srcset="/posts/wires_5/https.png, /posts/wires_5/https.png 1.5x, /posts/wires_5/https.png 2x"
            sizes="auto"
            alt="/posts/wires_5/https.png" height="176"  width="691" >
    </a><figcaption class="image-caption">Now API works with HTTPs</figcaption>
    </figure></div>

        <div class="sponsor">
        <div class="sponsor-avatar"></div><p class="sponsor-bio"><em>Say Hello :D</em></p><a href="https://github.com/AYehia0" title="Sponsor" target="_blank" class="sponsor-button" rel="noopener noreferrer">
                <i class="far fa-heart fa-fw icon" style="color: #ec6cb9;"></i>
                <span>Sponsor</span>
            </a></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-09-13</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"><button title="Share on Twitter" data-sharer="twitter" data-url="https://ayehia0.github.io/posts/wires_5/" data-title="Wires #5: Exploring the .NET Web API and enable HTTPs [Backend]"><span class="fab fa-twitter fa-fw"></span></button><button title="Share on Linkedin" data-sharer="linkedin" data-url="https://ayehia0.github.io/posts/wires_5/"><span class="fab fa-linkedin fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/wires_4/" class="prev" rel="prev" title="Wires #4: Production Server Setup"><i class="fas fa-angle-left fa-fw"></i>Wires #4: Production Server Setup</a>
            <a href="/posts/wires_6/" class="next" rel="next" title="Wires 6: Drawing The Map [Frontend]">Wires 6: Drawing The Map [Frontend]<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/AYehia0" target="_blank" rel="noopener noreferrer">Yehia</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":40},"comment":{},"data":{"desktop-header-typeit":"~/None","mobile-header-typeit":"~/None"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":true,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"No results found","snippetLength":30,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"sharerjs":true,"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript" src="https://.disqus.com/embed.js" defer></script></div>
</body>

</html>